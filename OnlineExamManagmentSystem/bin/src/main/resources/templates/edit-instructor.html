<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Edit Instructor</title>
    <script type="text/javascript">
        async function loadInstructor() {
            const instructorId = document.getElementById('selectInstructor').value;
            if(instructorId) {
                try {
                    const response = await fetch(`/schedule-manager/instructor/get?id=${instructorId}`);
                    const data = await response.json();
                    document.getElementById('firstName').value = data.instructorFirstName;
                    document.getElementById('lastName').value = data.instructorLastName;
                    document.getElementById('email').value = data.instructorEmail;
                    document.getElementById('username').value = data.instructorUsername;
                    // Assuming the password won't be sent for security reasons
                } catch (error) {
                    console.error('Error:', error);
                }
            }
        }

        async function updateInstructor(event) {
            event.preventDefault();  // Prevent the form from submitting the traditional way
            const form = event.target;
            const formData = new FormData(form);

            try {
                const response = await fetch(form.action, {
                    method: 'POST',
                    body: formData,
                });
                const data = await response.json();  // Assuming the server responds with JSON

                if (data.success) {
                    alert('Instructor updated successfully');
                } else {
                    alert('Success: ' + (data.error || 'Instructor Updated'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while updating the instructor.');
            }
        }
    </script>
</head>
<body>

<div class="container">
    <h2>Edit Instructor</h2>

    <form action="#" th:action="@{/schedule-manager/instructor/edit}" method="post" onsubmit="updateInstructor(event)">
        <div class="form-group">
            <label for="selectInstructor">Select Instructor:</label>
            <select id="selectInstructor" name="instructorId" onchange="loadInstructor()">
                <option value="" selected disabled>Choose an instructor</option>
                <option th:each="instructor : ${instructors}" 
                        th:value="${instructor.instructorId}" 
                        th:text="${instructor.instructorFirstName} + ' ' + ${instructor.instructorLastName}"></option>
            </select>
        </div>

        <!-- ... rest of the form fields ... -->

        <div class="form-group">
            <label for="firstName">First Name:</label>
            <input type="text" id="firstName" name="instructorFirstName" required>
        </div>
        
        <div class="form-group">
            <label for="lastName">Last Name:</label>
            <input type="text" id="lastName" name="instructorLastName" required>
        </div>
        
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="text" id="email" name="instructorEmail" required>
        </div>
        
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" name="instructorUsername" required>
        </div>
        
        <div class="form-group">
            <label for="password">New Password:</label>
            <input type="password" id="password" name="instructorPassword" required>
        </div>

        <button type="submit">Update Instructor</button>
    </form>

    <!-- Optionally, include a delete button if needed -->
    <form action="#" th:action="@{/schedule-manager/instructor/delete/{instructorId}}" method="post">
        <button type="submit">Delete Instructor</button>
    </form>

</div>

</body>
</html>
